{% extends "admin/change_form.html" %}
{% load static %}

{% block extrahead %}
  {{ block.super }}
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="{% static 'admin/js/jquery.init.js' %}"></script>
{% endblock %}

{% block content %}
  {{ block.super }}

  <script>
    (function($) {
      $(document).ready(function() {
        // Najdi input pole a přidej vedle něj tlačítko
        var input = $('#id_identifikacni_medium');
        if (input.length) {
          var button = $('<button type="button" class="btn btn-primary ms-2" id="read-rfid-btn">Načíst RFID</button>');
          input.after(button);
          $('<span id="rfid-status" class="ms-3"></span>').insertAfter(button);

          button.click(function() {
            $('#rfid-status').text('Probíhá načítání...');
            $.ajax({
              url: '{{ read_rfid_url }}',
              method: 'GET',
              success: function(data) {
                if (data.success) {
                  $('#id_identifikacni_medium').val(data.code);
                  $('#rfid-status').text('RFID načteno: ' + data.code);
                } else {
                  $('#rfid-status').text('Chyba: ' + data.error);
                }
              },
              error: function() {
                $('#rfid-status').text('Chyba při komunikaci s čtečkou.');
              }
            });
          });
        }
      });
    })(django.jQuery);
  </script>
{% endblock %}
